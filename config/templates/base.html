<!DOCTYPE html>
{% load static %}
<html lang="ru">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title>VAHTOWEEK</title>
	<!-- core:css -->
	<link rel="stylesheet" href="{% static 'assets/vendors/core/core.css' %}">
	<!-- endinject -->
	<!-- plugin css for this page -->
	<!-- end plugin css for this page -->
	<!-- inject:css -->
	{% block css_link %}
	{% endblock css_link %}
	<link rel="stylesheet" href="{% static 'assets/fonts/feather-font/css/iconfont.css' %}">
	<link rel="stylesheet" href="{% static 'assets/vendors/flag-icon-css/css/flag-icon.min.css' %}">
	<!-- endinject -->
	<!-- Layout styles -->
	<link rel="stylesheet" href="{% static 'assets/css/demo_1/style.css' %}">
	<!-- End layout styles -->
	<link rel="shortcut icon" href="{% static 'new_assets/img/logo.png' %}" />
	<link rel="stylesheet" href="{% static 'new_assets/css/input_range.css' %}">

	<style>
		.full-nav {
			width: 100%;
			left: 0;
		}
		.main-wrapper .page-wrapper {
			background-color: white!important;
		}
		.asteriskField {
    display: none;
}
		.select2-container--default .select2-selection--multiple .select2-selection__choice {
    background-color: #727cf5;
			font-size: 1rem;
}

		    .btn-my-outline-blue{
        color: #66BDCC!important;
        border-color: #66BDCC;
    }

    .btn-my-outline-blue:hover{
        color: white!important;
        background-color: #66BDCC!important;
        border-color: #66BDCC;
    }

    .btn-my-outline-orange{
        color: #EE7C58!important;
        border-color: #EE7C58;
    }

    .btn-my-outline-orange:hover{
        color: white!important;
        background-color: #EE7C58!important;
        border-color: #EE7C58;
    }

    .btn-my-outline-purple{
        color: #514378!important;
        border-color: #514378;
    }

    .btn-my-outline-purple:hover{
        color: white!important;
        background-color: #514378!important;
        border-color: #514378;
    }


	</style>


</head>
<body>
<div class="main-wrapper ">
	<div class="page-wrapper   full-page">
		<!-- header -->
		{% include 'include/header.html' %}
		<!-- end header -->
		<div class="page-content" >
			{% block page_content %}
			{% endblock page_content %}
		</div>

		<!-- Modal -->
		{% include 'app_account/include/logout_modal.html' %}
{% include 'app_account/include/login_modal.html' %}
{% include 'app_account/include/signup_modal.html' %}
{% include 'app_account/include/forgot_password_modal.html' %}
<!-- End modal -->
		<!-- footer -->
		{% include 'include/footer.html' %}
		<!-- end footer -->
	</div>
</div>

<!-- core:js -->
<script src="{% static 'assets/vendors/core/core.js' %}"></script>
<!-- endinject -->
<!-- plugin js for this page -->
<script src="{% static 'assets/vendors/jquery-validation/jquery.validate.min.js' %}"></script>
<script src="{% static 'assets/vendors/inputmask/jquery.inputmask.min.js' %}"></script>
{% block javascript_plugin %}
{% endblock javascript_plugin %}
<!-- end plugin js for this page -->
<!-- inject:js -->
<script src="{% static 'assets/vendors/feather-icons/feather.min.js' %}"></script>
<script src="{% static 'assets/js/template.js' %}"></script>
<!-- endinject -->
<!-- custom js for this page -->
<script src="{% static 'new_assets/js/form-validation.js' %}"></script>
<script src="{% static 'assets/js/inputmask.js' %}"></script>
{% block javascript_custom %}
{% endblock javascript_custom %}
<script type="text/javascript" language="JavaScript">
	// добавляем правило для валидации телефона
	jQuery.validator.addMethod("checkMaskPhone", function(value, element) {
		return /\+\d{1}\(\d{3}\)\d{3}-\d{4}/g.test(value);
	});
</script>
<script type="text/javascript" language="JavaScript">
    // Проверка - существует ли пользователь с таким номером телефона
    let phone = '';
    let status = false;
    jQuery.validator.addMethod("validatePhoneUser", function(value, element) {
        // create an AJAX call
        if (phone != value ) {
            phone = value;
            $.ajax({

                data: $(element).serialize(), // get the form data
                url: "{% url 'validate_username' %}",
                // on success

                success: function (response) {
                    if (response.is_taken == true) {
                        status = false;
                        return false;
                    }
                    else {
                        status = true;
                        return true;
                    }
                },
                // on error
                error: function (response) {
                    status = false;
                    return false;
                }
            });

        } else {
            return status;
        }
        return true;
    });
</script>
<script type="text/javascript" language="JavaScript">
    // Проверка - существует ли пользователь с таким email
    let emailSignUp = '';
    let statusEmail = false;
    jQuery.validator.addMethod("validateEmailUser", function(value, element) {
        // create an AJAX call
        if (emailSignUp != value ) {
            emailSignUp = value;
            $.ajax({
                data: $(element).serialize(), // get the form data
                url: "{% url 'validateEmailUser' %}",
                // on success
                success: function (response) {
                    if (response.is_taken == true) {
                        statusEmail = false;
                        return false;
                    }
                    else {
                        statusEmail = true;
                        return true;
                    }
                },
                // on error
                error: function (response) {
                    statusEmail = false;
                    return false;
                }
            });

        } else {
            return statusEmail;
        }
        return true;
    });
</script>
<script type="text/javascript" language="JavaScript">
    // Проверка - существует ли пользователь с таким номером телефона для сброса пароля
    let phoneForgotPassword = '';
    let statusForgotPassword = false;
    jQuery.validator.addMethod("validatePhoneForgotPasswordUser", function(value, element) {
        // create an AJAX call
        if (phoneForgotPassword != value ) {
            phoneForgotPassword = value;
            $.ajax({

                data: $(element).serialize(), // get the form data
                url: "{% url 'validateUsernameForgotPassword' %}",
                // on success

                success: function (response) {
                    if (response.is_taken == true) {
                        statusForgotPassword = true;
                        return true;
                    }
                    else {
                        statusForgotPassword = false;
                        return false;
                    }
                },
                // on error
                error: function (response) {
                    statusForgotPassword = false;
                    return false;
                }
            });

        } else {
            return statusForgotPassword;
        }
        return true;
    });
</script>
<script type="text/javascript" language="JavaScript">
    // Проверка - верно ли введён пароль и логин

    let DataLogin = '';
    let formLogin = $('#loginModalForm');
    let labelLogin = $('#labelLogin');

    $( "#loginButtonSubmit" ).on('click', function() {
        var statusFormLogin = $('#loginModalForm').valid();
        let newDataLogin = formLogin.serialize();
        if (DataLogin != newDataLogin ) {
            DataLogin = newDataLogin;
            // create an AJAX call
            if (statusFormLogin == true){
                $.ajax({
                    data: DataLogin, // get the form data
                    type: formLogin.attr('method'), // GET or POST
                    url: "{% url 'validateAuthenticate' %}",
                    // on success
                    success: function (response) {
                        if (response.is_taken == true) {
                            labelLogin.addClass('d-none');
                            formLogin.submit();
                        }
                        else {
                            labelLogin.removeClass("d-none");
                        }
                    },
                    // on error
                    error: function (response) {
                        labelLogin.removeClass("d-none");
                    }
                });
            }
        }
    });

</script>
<script type="text/javascript" language="JavaScript">
    // Регистрация

    let DataSignUp = '';
    let formSignUp = $('#signUpModalForm');
    let labelSignUp = $('#labelSignUp');
    let labelSignUpKey = $('#labelSignUpKey');
    $( "#signUpModalFormButton" ).on('click', function() {
        var statusSignUp = formSignUp.valid();
        let newDataSignUp = formSignUp.serializeArray();
        // newDataSignUp.push({name: "NonFormValue", value: 'vxfcbvfcb'});
        if (statusSignUp == true){
            if (DataSignUp != newDataSignUp ) {
                DataSignUp = newDataSignUp;
                // create an AJAX call
                $.ajax({
                    data: $.param(DataSignUp), // get the form data
                    type: formSignUp.attr('method'), // GET or POST
                    url: "{% url 'callRequest' %}",
                    // on success
                    success: function (response) {
                        if (response.is_taken) {
                            $('#fieldSetMainSignup').addClass('d-none');
                            $('#signUpModalFormButton').addClass('d-none');
                            $('#signUpModalCloseOneButton').addClass('d-none');

                            $('#signUpConfirmButton').removeClass('d-none');
                            $('#signUpConfirmButton').removeClass('d-none');
                            $('#fieldSetTwoSignup').removeClass('d-none');
                            // formSignUp.submit();
                        }
                        else {
                            labelSignUp.removeClass("d-none");
                            if (response.description) {
                                labelSignUp.text(response.description);
                            } else {
                                labelSignUp.text('Произошла ошибка, попробуйте позже');
                            }
                        }
                    },
                    // on error
                    error: function (response) {
                        labelSignUp.removeClass("d-none");
                        labelSignUp.text('Произошла ошибка, попробуйте позже');
                    }
                });
            }}
    });
    $( "#signUpConfirmButton" ).on('click', function() {
        var statusSignUp = formSignUp.valid();
        let newDataSignUp = formSignUp.serializeArray();
        if (statusSignUp == true){
            if (DataSignUp != newDataSignUp ) {
                DataSignUp = newDataSignUp;
                // create an AJAX call
                $.ajax({
                    data: $.param(DataSignUp), // get the form data
                    type: formSignUp.attr('method'), // GET or POST
                    url: "{% url 'validateToken' %}",
                    // on success
                    success: function (response) {
                        if (response.is_taken) {
                            labelSignUpKey.addClass("d-none");
                            formSignUp.submit();
                        }
                        else {
                            labelSignUpKey.removeClass("d-none");
                            if (response.description) {
                                labelSignUp.text(response.description);
                            } else {
                                labelSignUp.text('Произошла ошибка, попробуйте позже');
                            }
                        }
                    },
                    // on error
                    error: function (response) {
                        labelSignUpKey.removeClass("d-none");
                        labelSignUp.text('Произошла ошибка, попробуйте позже');
                    }
                });
            }}
    });
</script>
<script type="text/javascript" language="JavaScript">
    // Сброс пароля

    let DataForgotPassword = '';
    let formForgotPassword = $('#forgotPasswordModalForm');
    let labelForgotPassword = $('#labelForgotPassword');


    function ajaxForgotPassword(scene)  {
        var forgot_scene = scene;
        var forgot_url = '';
        if (forgot_scene == 1){
            forgot_url = "{% url 'callRequest' %}"
        } else{
            forgot_url = "{% url 'validateToken' %}"
        }

        var statusForgotPassword = formForgotPassword.valid();
        let newDataForgotPassword = formForgotPassword.serializeArray();
        if (statusForgotPassword == true){
            if (DataForgotPassword != newDataForgotPassword ) {
                DataForgotPassword = newDataForgotPassword;
                // create an AJAX call
                $.ajax({
                    data: $.param(DataForgotPassword), // get the form data
                    type: formForgotPassword.attr('method'), // GET or POST
                    url: forgot_url,
                    // on success
                    success: function (response) {
                        if (response.is_taken) {
                            if (forgot_scene == 1){
                                $('#fieldSetOneForgotPassword').addClass('d-none');
                                $('#fieldSetTwoForgotPassword').removeClass('d-none');

                                $('#forgotPasswordModalCloseOneButton').addClass('d-none');
                                $('#forgotPasswordModalCloseTwoButton').removeClass('d-none');

                                $('#forgotPasswordModalFormButton').addClass('d-none');
                                $('#forgotPasswordConfirmButton').removeClass('d-none');


                            } else if (forgot_scene == 2) {
                                $('#fieldSetTwoForgotPassword').addClass('d-none');
                                $('#fieldSetFreeForgotPassword').removeClass('d-none');

                                $('#forgotPasswordConfirmButton').addClass('d-none');
                                $('#forgotPasswordSubmitButton').removeClass('d-none');
                            }
                            labelForgotPassword.text('');
                        }
                        else {
                            labelForgotPassword.removeClass("d-none");
                            if (response.description) {
                                labelForgotPassword.text(response.description);
                            } else {
                                labelForgotPassword.text('Произошла ошибка, попробуйте позже');
                            }
                        }
                    },
                    // on error
                    error: function (response) {
                        labelForgotPassword.removeClass("d-none");
                        labelForgotPassword.text('Произошла ошибка, попробуйте позже');
                    }
                });
            }}
    }

</script>
<script type="text/javascript" language="JavaScript">
        // Блокирует кнопку регистрации пока не согласишся с условиями
    const checkbox = document.querySelector('#signUpCheckBox');
    const btn_submit = document.querySelector('#signUpModalFormButton');
    checkbox.addEventListener('change', () => {
        if ( checkbox.checked ) {
            btn_submit.removeAttribute('disabled');
        } else {
            btn_submit.setAttribute('disabled', 'true');
        }
    });
</script>

</body>
</html>